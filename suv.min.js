const e="AIzaSyCPbFD7_-Dfb6694tKO4Q7nymekTRmLubQ";const u="https://www.googleapis.com/youtube/v3/";const p={headers:{Accept:"application/json"}};const i=new URLSearchParams({key:e,part:"id,contentDetails",maxResults:"50"});const m=new URLSearchParams({key:e,part:"id,snippet,contentDetails,status"});function c(e){let t=document.getElementById(e);t.classList.add("hidden")}function d(e){let t=document.getElementById(e);t.classList.remove("hidden")}function a(e){const t=document.getElementById(e);if(t.value){t.classList.remove("is-invalid");return t.value}else t.classList.add("is-invalid")}async function l(e){const t=[];let n=null;let o=true;i.append("playlistId",e);while(o||n){if(n){i["delete"]("pageToken");i.append("pageToken",n)}const s=await fetch(`${u}playlistItems?${i.toString()}`,p).then(e=>e.json());for(const c of s.items)t.push(c["contentDetails"]["videoId"]);n=s["nextPageToken"];o=false}return t}async function r(t,n){const o=new Set;const s={};for(let e=0;e<t.length;e+=50){const c=t.slice(e,e+50).join();m["delete"]("id");m.append("id",c);const i=await fetch(`${u}videos?${m.toString()}`,p).then(e=>e.json());for(const d of i.items){const a=d["contentDetails"];if(a["regionRestriction"]){const l=a["regionRestriction"]["allowed"];const r=a["regionRestriction"]["blocked"];if(l&&!l.includes(n)||r&&r.includes(n))s[d.id]=d["snippet"]["title"];else o.add(d.id)}else o.add(d.id)}}return[o,s]}function f(e,t){const n=document.createElement("tr");const o=document.createElement("td");o.appendChild(document.createTextNode(e));n.appendChild(o);const s=document.createElement("td");s.appendChild(document.createTextNode(t?"Blocked":"Unavailable"));n.appendChild(s);const c=document.createElement("td");if(t)c.appendChild(document.createTextNode(t));n.appendChild(c);const i=document.createElement("td");const d=t?t:e;const a="https://www.google.com/search?q="+d;const l=document.createElement("a");l.setAttribute("href",a);l.innerHTML="Google";i.appendChild(l);n.appendChild(i);return n}async function h(e,t,n){const o=document.getElementById("tablebody");o.replaceChildren();for(const s of e){if(t.has(s))continue;const c=f(s,n[s]);o.appendChild(c)}}window.addEventListener("load",async function(){document.getElementById("submit").onclick=async function(){const e=a("playlistId");const t=a("countryCode");if(!e||!t)return;c("table");c("resultsText");d("spinner");const n=await l(e);const[o,s]=await r(n,t);c("spinner");if(n.length!==o.size){await h(n,o,s);d("table")}else d("resultsText")}});
